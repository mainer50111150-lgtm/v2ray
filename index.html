<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ú©Ø§Ù†ÙÛŒÚ¯ Ø±Ø§ÛŒÚ¯Ø§Ù† Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ</title>
<style>
body {
    font-family: Tahoma;
    background:#2e2e2e;
    color:#fff;
    margin:0;
    padding:20px;
    display: flex;
    flex-direction: column;
    align-items: center;
}

.container {
    max-width:600px;
    width: 100%;
    margin:auto;
    background:#444;
    padding:25px;
    border-radius:12px;
    text-align:center;
    box-shadow:0 0 20px #000;
}

h1 { color:#4fc3f7; margin-bottom: 25px; }

.button-group {
    display: flex;
    flex-wrap: wrap;
    gap:10px;
    justify-content: center;
    margin-top: 20px;
}

/* Ø¯Ú©Ù…Ù‡ Ø¨Ø²Ø±Ú¯ ÙˆØ³Ø· ØµÙØ­Ù‡ Ø§Ù…Ø§ Ø¬Ù…Ø¹ Ùˆ Ø¬ÙˆØ± */
#one {
    width: 30%;
    padding: 18px;
    font-size: 20px;
    border-radius: 10px;
    background: #4caf50;
    color: #fff;
    cursor: pointer;
    margin-bottom: 15px;
    transition: transform 0.2s, background 0.2s;
}

#one:hover {
    background: #45a049;
    transform: scale(1.05);
}

/* Ø¨Ù‚ÛŒÙ‡ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ Ú©ÙˆÚ†Ú©â€ŒØªØ± Ùˆ Ù¾Ø§ÛŒÛŒÙ† */
.btn {
    width: 48%;
    padding:12px;
    border:none;
    border-radius:8px;
    cursor:pointer;
    background:#2196f3;
    color:#fff;
    font-size:15px;
    transition: transform 0.2s, background 0.2s;
}

.btn:hover { 
    background:#1976d2;
    transform: scale(1.05);
}

.red{ background:#f44336; }
.support{ background:#25d366; }
.support:hover{ background:#1da851; }

#msg {
    display:none;
    margin-top:15px;
    padding:10px;
    border-radius:6px;
    font-weight:bold;
}

.footer {
    margin-top:20px;
    font-size:14px;
    color:#ccc;
    text-align: center;
    font-weight: bold;
}
</style>
</head>
<body>

    <!-- Modal Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ Ù…ØªÙ† Ú©Ù¾ÛŒ -->
<div id="copyModal" style="
    display:none;
    position:fixed;
    top:0; left:0;
    width:100%; height:100%;
    background:rgba(0,0,0,0.6);
    justify-content:center;
    align-items:center;
    z-index:99999;
">
    <div style="
        background:#fff;
        color:#000;
        padding:20px;
        border-radius:10px;
        max-width:400px;
        width:90%;
        text-align:center;
        position:relative;
    ">
        <h3>Ú©Ø§Ù†ÙÛŒÚ¯ Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡</h3>
        <textarea id="modalText" style="width:100%; height:120px; margin-top:10px; font-family:monospace; font-size:14px;" readonly></textarea>
        <div style="margin-top:15px;">
            <button id="modalCopy" style="padding:10px 20px; background:#4caf50; color:#fff; border:none; border-radius:5px; cursor:pointer;">Ú©Ù¾ÛŒ Ú©Ø±Ø¯Ù†</button>
            <button id="modalClose" style="padding:10px 20px; background:#f44336; color:#fff; border:none; border-radius:5px; cursor:pointer;">Ø¨Ø³ØªÙ†</button>
        </div>
    </div>
</div>

<div class="container">
<h1>Ú©Ø§Ù†ÙÛŒÚ¯ Ø±Ø§ÛŒÚ¯Ø§Ù†ğŸ“¡</h1>

<div class="info">
ğŸ“¡ ØªØ¹Ø¯Ø§Ø¯: <span id="count">0</span> | â° Ø¢Ø®Ø±ÛŒÙ† Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ: <span id="time">---</span>
</div>

<!-- Ø¯Ú©Ù…Ù‡ Ø¬Ù…Ø¹ Ùˆ Ø¬ÙˆØ± ÙˆØ³Ø· ØµÙØ­Ù‡ -->
<button id="one">Ú©Ù¾ÛŒ Ú©Ø§Ù†ÙÛŒÚ¯</button>

<!-- Ø¨Ù‚ÛŒÙ‡ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ -->
<div class="button-group">
<button class="btn green" id="refresh">ğŸ”„ Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ</button>
<button class="btn support" id="support">ğŸ’¬ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ ØªÙ„Ú¯Ø±Ø§Ù…</button>
<button class="btn red" id="clear">ğŸ—‘ï¸ Ø­Ø°Ù Ú©Ø´</button>
</div>

<div id="msg"></div>

<div class="footer" style="color: #000; background-color: #1976d2; border-radius: 5px; padding-bottom: 5px;">
Ù†Ú©ØªÙ‡: Ú©Ø§Ù†ÙÛŒÚ¯â€ŒÙ‡Ø§ Ø¯ÙˆÙ†Ù‡â€ŒØ¯ÙˆÙ†Ù‡ Ùˆ ØªØ±ØªÛŒØ¨ÛŒ Ø§Ø² Ù¾Ø§ÛŒÛŒÙ† Ø¨Ù‡ Ø¨Ø§Ù„Ø§ Ú©Ù¾ÛŒ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯<br>Ø¢Ø®Ø±ÛŒÙ† Ø®Ø·ÙˆØ· ÙØ§ÛŒÙ„ Ø¯Ø± Ø§ÙˆÙ„ÙˆÛŒØª Ù‡Ø³ØªÙ†Ø¯
</div>
</div>

<script>
// --- Ú©Ø¯Ù‡Ø§ÛŒ JS Ø§ØµÙ„Ø§Ø­ Ø´Ø¯Ù‡ Ø¨Ø§ ÙÛŒÙ„ØªØ± ---
const URL = "https://raw.githubusercontent.com/ebrasha/free-v2ray-public-list/refs/heads/main/all_extracted_configs.txt";
const CACHE = "VLESS_CACHE_PRO";
const USED_KEY = "USED_CONFIGS_PRO"; // Ú©Ø§Ù†ÙÛŒÚ¯â€ŒÙ‡Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡â€ŒØ´Ø¯Ù‡

const TIME = 30 * 60 * 1000;
let configs = [];
let currentIndex = -1; // Ù…ØªØºÛŒØ± Ø³Ø±Ø§Ø³Ø±ÛŒ Ø¨Ø±Ø§ÛŒ Ø±Ø¯ÛŒØ§Ø¨ÛŒ Ø¢Ø®Ø±ÛŒÙ† Ø®Ø· Ú©Ù¾ÛŒ Ø´Ø¯Ù‡ (Ø´Ø±ÙˆØ¹ Ø§Ø² Ù¾Ø§ÛŒÛŒÙ†)

// --- ØªØ¹Ø±ÛŒÙ Ú©Ù„Ù…Ø§Øª ÙÛŒÙ„ØªØ± Ø´ÙˆÙ†Ø¯Ù‡ ØªÙˆØ³Ø· Ú©Ø§Ø±Ø¨Ø± ---
// Ù‡Ø± Ú©Ù„Ù…Ù‡â€ŒØ§ÛŒ Ú©Ù‡ Ø¯Ø± Ø§ÛŒÙ† Ø¢Ø±Ø§ÛŒÙ‡ Ø¨Ø§Ø´Ø¯ØŒ Ø§Ú¯Ø± Ø¯Ø± Ù„ÛŒÙ†Ú© Ú©Ø§Ù†ÙÛŒÚ¯ (vless://, vmess://) Ù¾ÛŒØ¯Ø§ Ø´ÙˆØ¯ØŒ Ø¢Ù† Ù„ÛŒÙ†Ú© Ø­Ø°Ù Ø®ÙˆØ§Ù‡Ø¯ Ø´Ø¯.
const FORBIDDEN_WORDS = ['Ú©Ø§Ù†Ø§Ù„']; 
// --- Ù¾Ø§ÛŒØ§Ù† ØªØ¹Ø±ÛŒÙ Ú©Ù„Ù…Ø§Øª ÙÛŒÙ„ØªØ± Ø´ÙˆÙ†Ø¯Ù‡ ---

// Ú¯Ø±ÙØªÙ† Ù„ÛŒØ³Øª Ú©Ø§Ù†ÙÛŒÚ¯â€ŒÙ‡Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø´Ø¯Ù‡
function getUsedConfigs() {
    return JSON.parse(localStorage.getItem(USED_KEY) || "[]");
}

function saveUsedConfig(cfg) {
    let used = getUsedConfigs();
    if (!used.includes(cfg)) {
        used.push(cfg);
        localStorage.setItem(USED_KEY, JSON.stringify(used));
    }

    // Ø°Ø®ÛŒØ±Ù‡ Ø¢Ø®Ø±ÛŒÙ† Ø´Ø§Ø®Øµ
    localStorage.setItem("LAST_INDEX", currentIndex);
}


// Ù†Ù…Ø§ÛŒØ´ Ù¾ÛŒØ§Ù…
function show(text, color) {
    let m = document.getElementById("msg");
    m.innerText = text;
    m.style.background = color;
    m.style.display = "block";
    setTimeout(() => { m.style.display = "none"; }, 3000);
}

// Ú©Ø´
function save() {
    localStorage.setItem(CACHE, JSON.stringify({ time: Date.now(), list: configs }));
}

function loadCache() {
    let c = localStorage.getItem(CACHE);
    if (!c) return false;
    let data = JSON.parse(c);
    if (Date.now() - data.time > TIME) return false;
    
    configs = data.list;

    // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø´Ø§Ø®Øµ Ø¢Ø®Ø±ÛŒÙ† Ú©Ø§Ù†ÙÛŒÚ¯
    let savedIndex = parseInt(localStorage.getItem("LAST_INDEX"));
    if (!isNaN(savedIndex)) {
        currentIndex = savedIndex;
    } else {
        currentIndex = configs.length - 1;
    }

    updateUI(data.time);
    show("âœ… Ø§Ø² Ú©Ø´ Ø¨Ø§Ø±Ú¯Ø²Ø§Ø±ÛŒ Ø´Ø¯","#4caf50");
    return true;
}


// ØªØ§Ø¨Ø¹ ÙÛŒÙ„ØªØ±
function filterConfigs(rawText) {
    let lines = rawText.split("\n")
        .map(l => l.trim())
        .filter(l =>
            l.length > 0 &&
            /^(vless|vmess|trojan|ss):\/\//i.test(l)
        );

    let filteredList = [];
    let removedCount = 0;

    for (const line of lines) {
        let shouldKeep = true;

        for (const word of FORBIDDEN_WORDS) {
            if (line.toLowerCase().includes(word.toLowerCase())) {
                shouldKeep = false;
                removedCount++;
                break;
            }
        }

        if (shouldKeep) filteredList.push(line);
    }

    show(`âš ï¸ ${removedCount} Ú©Ø§Ù†ÙÛŒÚ¯ ÙÛŒÙ„ØªØ± Ø´Ø¯`, "#ff9800");

    return filteredList;
}




async function fetchData() {

    if (configs.length && currentIndex >= 0) return;

    show("â³ Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ...","#ff9800");

    try {

        let res = await fetch(URL + "?v=" + Date.now());
        if (!res.ok) throw "error";

        let text = await res.text();

        let used = getUsedConfigs();

        let all = filterConfigs(text);

        // Ø­Ø°Ù Ù…ØµØ±Ùâ€ŒØ´Ø¯Ù‡â€ŒÙ‡Ø§
        let fresh = all.filter(c => !used.includes(c));

        if (!fresh.length) {
            show("âš ï¸ Ú©Ø§Ù†ÙÛŒÚ¯ Ø¬Ø¯ÛŒØ¯ÛŒ Ù†ÛŒØ³Øª","#ff9800");
            return;
        }

        configs = fresh;
        currentIndex = configs.length - 1;

        save();
        updateUI(Date.now());

        show(`âœ… ${configs.length} Ú©Ø§Ù†ÙÛŒÚ¯ Ø¬Ø¯ÛŒØ¯ Ø¢Ù…Ø§Ø¯Ù‡ Ø´Ø¯`,"#4caf50");

    } catch {

        show("âŒ Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª","#f44336");

    }
}



// Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ UI
function updateUI(t) {
    document.getElementById("count").innerText = configs.length;
    document.getElementById("time").innerText = new Date(t).toLocaleString("fa-IR");
}


// --- Ù…Ù†Ø·Ù‚ Ú©Ù¾ÛŒ ØªØ±ØªÛŒØ¨ÛŒ Ø§Ø² Ù¾Ø§ÛŒÛŒÙ† Ø¨Ù‡ Ø¨Ø§Ù„Ø§ ---

function getNextConfig() {
    if (!configs.length) {
        show("âŒ Ù„ÛŒØ³Øª Ú©Ø§Ù†ÙÛŒÚ¯â€ŒÙ‡Ø§ Ø®Ø§Ù„ÛŒ Ø§Ø³Øª","#f44336");
        return null;
    }

    const used = getUsedConfigs();

    while (currentIndex >= 0) {
        let cfg = configs[currentIndex];
        currentIndex--; // Ø­Ø±Ú©Øª Ø¨Ù‡ Ú©Ø§Ù†ÙÛŒÚ¯ Ù‚Ø¯ÛŒÙ…ÛŒâ€ŒØªØ±

        // Ø§Ú¯Ø± Ú©Ø§Ù†ÙÛŒÚ¯ Ù‚Ø¨Ù„Ø§Ù‹ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù†Ø´Ø¯Ù‡ Ø¨ÙˆØ¯ØŒ Ø¨Ø±Ú¯Ø±Ø¯Ø§Ù†
        if (!used.includes(cfg)) {
            return cfg;
        }
    }

    show("âš ï¸ ØªÙ…Ø§Ù… Ø®Ø·ÙˆØ· Ú©Ù¾ÛŒ Ø´Ø¯Ù†Ø¯ØŒ Ù„Ø·ÙØ§Ù‹ Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ú©Ù†ÛŒØ¯","#ff9800");
    currentIndex = -1; // Ø±ÛŒØ³Øª Ú©Ø±Ø¯Ù† Ø¨Ø±Ø§ÛŒ ØªÙ„Ø§Ø´ Ø¨Ø¹Ø¯ÛŒ
    return null;
}


// ØªØ§Ø¨Ø¹ Ú©Ù…Ú©ÛŒ Ø¨Ø±Ø§ÛŒ Ú©Ù¾ÛŒ Ú©Ø±Ø¯Ù† Ù…ØªÙ† (Ø¨Ø§ Ø³Ø§Ø²Ú¯Ø§Ø±ÛŒ Ù…ÙˆØ¨Ø§ÛŒÙ„)
function copyTextToClipboard(text) {
    // 1. ØªÙ„Ø§Ø´ Ø¨Ø±Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Clipboard API Ù…Ø¯Ø±Ù†
    if (navigator.clipboard && navigator.clipboard.writeText) {
        navigator.clipboard.writeText(text).then(() => {
            show("âœ… Ú©Ù¾ÛŒ Ø´Ø¯","#4caf50");
        }).catch(() => {
            // 2. Ø§Ú¯Ø± Ø±ÙˆØ´ Ù…Ø¯Ø±Ù† Ø´Ú©Ø³Øª Ø®ÙˆØ±Ø¯ØŒ Ø¨Ù‡ Ø±ÙˆØ´ Ù‚Ø¯ÛŒÙ…ÛŒ Ø¨Ø±ÙˆÛŒØ¯ (Ù…Ø®ØµÙˆØµØ§Ù‹ Ø§Ù†Ø¯Ø±ÙˆÛŒØ¯)
            fallbackCopyText(text);
        });
    } else {
        // Ø§Ú¯Ø± Ù…Ø±ÙˆØ±Ú¯Ø± Ø§ØµÙ„Ø§Ù‹ Clipboard API Ø±Ø§ Ù†Ø¯Ø§Ø±Ø¯
        fallbackCopyText(text);
    }
}

// Fallback Ø¨Ø±Ø§ÛŒ Ú©Ù¾ÛŒ Ú©Ø±Ø¯Ù† (Ù…Ù‡Ù… Ø¨Ø±Ø§ÛŒ Ø§Ù†Ø¯Ø±ÙˆÛŒØ¯)
function fallbackCopyText(text) {
    let textArea = document.createElement("textarea");
    textArea.value = text;
    
    // ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø¨Ø±Ø§ÛŒ Ù¾Ù†Ù‡Ø§Ù† Ú©Ø±Ø¯Ù† textarea
    textArea.style.position = "fixed";
    textArea.style.top = "0";
    textArea.style.left = "0";
    textArea.style.opacity = "0";
    
    document.body.appendChild(textArea);
    textArea.focus();
    textArea.select();

    try {
        document.execCommand('copy');
        show("âœ… Ú©Ù¾ÛŒ Ø´Ø¯ (Fallback)","#4caf50");
    } catch (err) {
        show("âŒ Ú©Ù¾ÛŒ Ø¨Ø§ Ø´Ú©Ø³Øª Ù…ÙˆØ§Ø¬Ù‡ Ø´Ø¯","#f44336");
        console.error('Fallback copy failed:', err);
    }

    document.body.removeChild(textArea);
}


// ØªØ§Ø¨Ø¹ Ø§ØµÙ„ÛŒ Ú©Ù‡ Ù‡Ù†Ú¯Ø§Ù… Ú©Ù„ÛŒÚ© Ø±ÙˆÛŒ Ø¯Ú©Ù…Ù‡ "Ú©Ù¾ÛŒ Ú©Ø§Ù†ÙÛŒÚ¯" ÙØ±Ø§Ø®ÙˆØ§Ù†ÛŒ Ù…ÛŒ Ø´ÙˆØ¯
function copyOneSequential() {
    let cfg = getNextConfig();
    if (!cfg) return;

    const modal = document.getElementById("copyModal");
    const modalText = document.getElementById("modalText");
    const modalCopyButton = document.getElementById("modalCopy");
    const modalCloseButton = document.getElementById("modalClose");

    // Ù†Ù…Ø§ÛŒØ´ Ù…ÙˆØ¯Ø§Ù„
    modal.style.display = "flex";
    modalText.value = cfg;

    // Ø°Ø®ÛŒØ±Ù‡ Ø§ÙˆÙ„ÛŒÙ† Ú©Ø§Ù†ÙÛŒÚ¯
    saveUsedConfig(cfg);

    // Ú©Ù¾ÛŒ Ø®ÙˆØ¯Ú©Ø§Ø±
    copyTextToClipboard(cfg);

    // Ø¯Ú©Ù…Ù‡ Ø¨Ø¹Ø¯ÛŒ
    modalCopyButton.onclick = () => {

        let nextCfg = getNextConfig();

        if (nextCfg) {

            modalText.value = nextCfg;

            copyTextToClipboard(nextCfg);

            // Ø°Ø®ÛŒØ±Ù‡ Ù‡Ù…Ù‡ Ú©Ø§Ù†ÙÛŒÚ¯â€ŒÙ‡Ø§
            saveUsedConfig(nextCfg);

        } else {

            modalText.value = "Ù‡Ù…Ù‡ Ø®Ø·ÙˆØ· ØªÙ…Ø§Ù… Ø´Ø¯.";
            modalCopyButton.disabled = true;

        }
    };

    // Ø¨Ø³ØªÙ†
    modalCloseButton.onclick = () => modal.style.display = "none";

    modal.onclick = (e) => {
        if (e.target === modal) modal.style.display = "none";
    };
}



// Ø´Ø±ÙˆØ¹
document.addEventListener("DOMContentLoaded", () => {
// Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø®ÙˆØ¯Ú©Ø§Ø± Ù‡Ø± 1 Ø¯Ù‚ÛŒÙ‚Ù‡
setInterval(() => {
    fetchData();
}, 120000); // 60000 Ù…ÛŒÙ„ÛŒâ€ŒØ«Ø§Ù†ÛŒÙ‡ = 1 Ø¯Ù‚ÛŒÙ‚Ù‡

    // Ø§ÙˆÙ„ Ø³Ø¹ÛŒ Ú©Ù† Ø§Ø² Ú©Ø´ Ø¨Ø®ÙˆØ§Ù†Ø¯
    if (!loadCache()) {
        show("â³ Ø¯Ø± Ø­Ø§Ù„ Ø¯Ø±ÛŒØ§ÙØª Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯...","#2196f3");
        fetchData();
    }

    // Event Listeners
    document.getElementById("refresh").onclick = fetchData;

    document.getElementById("clear").onclick = () => { 
        localStorage.removeItem(CACHE); 
        localStorage.removeItem(USED_KEY);

        currentIndex = -1;
        configs = [];

        document.getElementById("count").innerText = 0;

        show("ğŸ—‘ï¸ Ù‡Ù…Ù‡ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ù¾Ø§Ú© Ø´Ø¯","#2196f3"); 
    };

    document.getElementById("one").onclick = copyOneSequential;

    document.getElementById("support").onclick = () => {
        window.open("https://t.me/BTC_ETH_DOG_SOL", "_blank");
    };
});

</script>


</body>
</html>

